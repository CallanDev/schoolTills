<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional School Till System</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#f0f2f5; }
  header { background:#1e1e2f; color:#fff; padding:15px; text-align:center; font-size:1.5em; }
  #loginOverlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:999; }
  #loginBox { background:#fff; padding:30px; border-radius:10px; width:350px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.3); }
  #loginBox input { width:80%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; }
  #loginBox button { padding:10px 20px; border:none; border-radius:5px; background:#1e1e2f; color:#fff; cursor:pointer; font-weight:700; }
  .hidden { display:none; }
  #nav { background:#2b2b45; padding:10px; display:flex; gap:10px; }
  #nav button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; background:#4b4b7b; color:#fff; font-weight:600; }
  #main { padding:20px; }
  #itemsGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:15px; }
  .itemBtn { padding:20px; background:#fff; border:none; border-radius:10px; cursor:pointer; font-size:14px; box-shadow:0 2px 5px rgba(0,0,0,0.1); transition:0.2s; text-align:center; }
  .itemBtn:hover { transform:scale(1.05); background:#e3e3e3; }
  #basket { margin-top:20px; background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  #basket h3 { margin-top:0; }
  #studentSearchPopup, #backofficePopup, #alertsPopup { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); display:none; align-items:center; justify-content:center; z-index:1000; }
  #studentSearchBox, #backofficeBox, #alertsBox { background:#fff; padding:20px; border-radius:10px; width:500px; max-height:80%; overflow-y:auto; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
  #studentList { max-height:250px; overflow-y:auto; margin-top:10px; border:1px solid #ccc; border-radius:5px; }
  .studentEntry { padding:10px; cursor:pointer; border-bottom:1px solid #eee; transition:0.2s; }
  .studentEntry:hover { background:#f0f0f0; }
  #backofficeBox input, #backofficeBox select { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
  #backofficeBox button { padding:10px 15px; border:none; border-radius:5px; background:#1e1e2f; color:#fff; cursor:pointer; margin-top:10px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  table, th, td { border:1px solid #ccc; }
  th, td { padding:8px; text-align:left; }
  th { background:#4b4b7b; color:#fff; }
  .alert { background:#ffefef; color:#b00; padding:10px; border-radius:5px; margin:5px 0; }
</style>
</head>
<body>

<header>School Till System</header>

<div id="loginOverlay">
  <div id="loginBox">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red; display:none;">Invalid credentials</p>
  </div>
</div>

<div id="nav" class="hidden">
  <button onclick="showPage('till')">Till</button>
  <button onclick="showPage('backoffice')">Back Office</button>
  <button onclick="showPage('settings')">Settings</button>
  <button onclick="logout()">Logout</button>
</div>

<div id="main">
  <div id="tillPage" class="hidden">
    <h2>Till</h2>
    <div id="itemsGrid"></div>
    <div id="basket">
      <h3>Basket</h3>
      <ul id="basketList"></ul>
      <p>Total: £<span id="basketTotal">0.00</span></p>
      <button onclick="startCheckout()">Checkout</button>
    </div>
  </div>

  <div id="backofficePage" class="hidden">
    <h2>Back Office</h2>
    <button onclick="openBackOffice()">Manage Menu & Students</button>
  </div>

  <div id="settingsPage" class="hidden">
    <h2>Settings</h2>
    <form id="settingsForm" onsubmit="saveSettings(event)">
      <label>Overdraft Limit (£):<input type="number" id="overdraftLimit" step="0.01"></label>
      <label>Enable Discounts:<select id="enableDiscounts"><option value="yes">Yes</option><option value="no">No</option></select></label>
      <label>Tax Rate (%):<input type="number" id="taxRate" step="0.01"></label>
      <label>Daily Spending Cap (£):<input type=\"number\" id=\"dailyCap\" step=\"0.01\"></label>
      <label>Receipt Printing:<select id="receiptPrinting"><option value="enabled">Enabled</option><option value="disabled">Disabled</option></select></label>
      <button type="submit">Save Settings</button>
    </form>
  </div>
</div>

<div id="studentSearchPopup">
  <div id="studentSearchBox">
    <h3>Select Student</h3>
    <input type="text" id="studentSearchInput" placeholder="Type to search..." onkeyup="filterStudents()">
    <div id="studentList"></div>
    <button onclick="closeStudentSearch()">Cancel</button>
  </div>
</div>

<div id="backofficePopup">
  <div id="backofficeBox">
    <h3>Back Office Management</h3>
    <h4>Items</h4>
    <input type="text" id="newItemName" placeholder="Item Name">
    <input type="number" id="newItemPrice" placeholder="Price">
    <button onclick="addItem()">Add Item</button>
    <table id="itemsTable"><thead><tr><th>Name</th><th>Price</th><th>Action</th></tr></thead><tbody></tbody></table>

    <h4>Students</h4>
    <input type="text" id="newStudentName" placeholder="Student Name">
    <select id="newStudentYear">
      <option>S1</option><option>S2</option><option>S3</option><option>S4</option><option>S5</option><option>S6</option>
    </select>
    <input type="number" id="newStudentBalance" placeholder="Balance">
    <label><input type="checkbox" id="newStudentNoFood"> No School Food</label>
    <label><input type="checkbox" id="newStudentParent"> Parent Approval</label>
    <button onclick="addStudent()">Add Student</button>
    <table id="studentsTable"><thead><tr><th>Name</th><th>Year</th><th>Balance</th><th>No School Food</th><th>Parent Approval</th><th>Action</th></tr></thead><tbody></tbody></table>

    <h4>Meal Planner</h4>
    <textarea id="mealPlanner" rows="5" placeholder="Set daily menu..."></textarea>
    <button onclick="saveMealPlanner()">Save Menu</button>

    <button onclick="closeBackOffice()">Close</button>
  </div>
</div>

<div id="alertsPopup">
  <div id="alertsBox">
    <h3>Alerts</h3>
    <div id="alertsContainer"></div>
    <button onclick="closeAlerts()">Close</button>
  </div>
</div>

<script>
let role = null;
let basket = [];
let students = [
  {name:"Alice Smith",year:"S1",balance:20,noSchoolFood:false,parentApproval:false},
  {name:"Bob Jones",year:"S2",balance:5,noSchoolFood:true,parentApproval:false},
  {name:"Charlie Brown",year:"S3",balance:-5,noSchoolFood:false,parentApproval:true}
];
let items = [
  {code:"100001",name:"Sandwich",price:2.50},
  {code:"100002",name:"Juice",price:1.20},
  {code:"100003",name:"Snack Bar",price:0.80},
  {code:"100004",name:"Salad",price:3.00}
];
let settings = {overdraftLimit:-10, enableDiscounts:"no", taxRate:0, dailyCap:10, receiptPrinting:"enabled"};
let alerts = [];

function login(){
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  if((u==="Cashier"||u==="Admin"||u==="Manager") && p==="Mabelcat1CC!!"){
    role = u;
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("nav").classList.remove("hidden");
    showPage('till'); renderItems(); loadSettings(); renderStudents(); renderItemsTable();
  } else document.getElementById("loginError").style.display="block";
}

function logout(){
  role = null;
  basket = [];
  document.getElementById("loginOverlay").style.display="flex";
  document.getElementById("nav").classList.add("hidden");
  showPage('till');
}

function showPage(page){
  ['tillPage','backofficePage','settingsPage'].forEach(p=>document.getElementById(p).classList.add('hidden'));
  if(page==='till') document.getElementById('tillPage').classList.remove('hidden');
  if(page==='backoffice') document.getElementById('backofficePage').classList.remove('hidden');
  if(page==='settings') document.getElementById('settingsPage').classList.remove('hidden');
}

function renderItems(){
  const grid = document.getElementById('itemsGrid'); grid.innerHTML='';
  items.forEach(item=>{
    const btn = document.createElement('button');
    btn.className='itemBtn';
    btn.textContent=`${item.name}\n£${item.price.toFixed(2)}`;
    btn.onclick=()=>{ basket.push(item); updateBasket(); };
    grid.appendChild(btn);
  });
}

function updateBasket(){
  const list = document.getElementById('basketList'); list.innerHTML=''; let total=0;
  basket.forEach(i=>{ total+=i.price; const li=document.createElement('li'); li.textContent=`${i.name} £${i.price.toFixed(2)}`; list.appendChild(li); });
  if(settings.taxRate>0) total+=total*(settings.taxRate/100);
  document.getElementById('basketTotal').textContent=total.toFixed(2);
}

function startCheckout(){
  if(basket.length===0){ showAlert('Basket is empty!'); return;}
  document.getElementById('studentSearchPopup').style.display='flex'; renderStudentList(students);
}
function closeStudentSearch(){ document.getElementById('studentSearchPopup').style.display='none'; }

function renderStudentList(list){
  const c = document.getElementById('studentList'); c.innerHTML='';
  list.forEach(stu=>{
    const div = document.createElement('div'); div.className='studentEntry';
    div.textContent=`${stu.name} (${stu.year}) Balance: £${stu.balance.toFixed(2)}`;
    div.onclick=()=>selectStudent(stu);
    c.appendChild(div);
  });
}
function filterStudents(){
  const q=document.getElementById('studentSearchInput').value.toLowerCase();
  renderStudentList(students.filter(s=>s.name.toLowerCase().includes(q)));
}

function selectStudent(stu){
  let total=basket.reduce((a,i)=>a+i.price,0);
  if(settings.taxRate>0) total+=total*(settings.taxRate/100);
  if(stu.noSchoolFood && role==='Cashier'){ showAlert('This student is marked NO SCHOOL FOOD. Manager/Admin approval required.'); return;}
  if(stu.parentApproval && role==='Cashier'){ showAlert('Parent/Admin approval required.'); return;}
  if(stu.balance-total<settings.overdraftLimit){ showAlert('Transaction denied: exceeds overdraft limit.'); return;}
  if(total>settings.dailyCap){ showAlert('Transaction denied: exceeds daily spending cap.'); return;}
  stu.balance-=total; showAlert(`Transaction complete for ${stu.name}. New balance: £${stu.balance.toFixed(2)}`);
  basket=[]; updateBasket(); closeStudentSearch(); renderStudents(); renderStudentsTable();
}

function saveSettings(e){ 
  e.preventDefault(); 
  settings.overdraftLimit=parseFloat(document.getElementById('overdraftLimit').value)||settings.overdraftLimit; 
  settings.enableDiscounts=document.getElementById('enableDiscounts').value; 
  settings.taxRate=parseFloat(document.getElementById('taxRate').value)||0; 
  settings.dailyCap=parseFloat(document.getElementById('dailyCap').value)||10;
  settings.receiptPrinting=document.getElementById('receiptPrinting').value; 
  showAlert('Settings saved.');
}
function loadSettings(){
  document.getElementById('overdraftLimit').value=settings.overdraftLimit; 
  document.getElementById('enableDiscounts').value=settings.enableDiscounts; 
  document.getElementById('taxRate').value=settings.taxRate; 
  document.getElementById('dailyCap').value=settings.dailyCap;
  document.getElementById('receiptPrinting').value=settings.receiptPrinting;
}

function openBackOffice(){ document.getElementById('backofficePopup').style.display='flex'; renderStudentsTable(); renderItemsTable(); }
function closeBackOffice(){ document.getElementById('backofficePopup').style.display='none'; }

function addItem(){
  const name=document.getElementById('newItemName').value;
  const price=parseFloat(document.getElementById('newItemPrice').value);
  if(!name||isNaN(price)){ showAlert('Enter valid item name and price'); return;}
  items.push({code:Date.now().toString(), name, price}); renderItems(); renderItemsTable();
}

function renderItemsTable(){
  const tbody=document.getElementById('itemsTable').querySelector('tbody'); tbody.innerHTML='';
  items.forEach((i,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i.name}</td><td>£${i.price.toFixed(2)}</td><td><button onclick="deleteItem(${idx})">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

function deleteItem(idx){ items.splice(idx,1); renderItems(); renderItemsTable(); }

function addStudent(){
  const name=document.getElementById('newStudentName').value;
  const year=document.getElementById('newStudentYear').value;
  const balance=parseFloat(document.getElementById('newStudentBalance').value);
  const noFood=document.getElementById('newStudentNoFood').checked;
  const parent=document.getElementById('newStudentParent').checked;
  if(!name||isNaN(balance)){ showAlert('Enter valid student info'); return;}
  students.push({name, year, balance, noSchoolFood:noFood, parentApproval:parent});
  renderStudents(); renderStudentsTable();
}

function renderStudentsTable(){
  const tbody=document.getElementById('studentsTable').querySelector('tbody'); tbody.innerHTML='';
  students.forEach((s,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${s.name}</td><td>${s.year}</td><td>£${s.balance.toFixed(2)}</td><td>${s.noSchoolFood}</td><td>${s.parentApproval}</td><td><button onclick="deleteStudent(${idx})">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

function deleteStudent(idx){ students.splice(idx,1); renderStudents(); renderStudentsTable(); }

function renderStudents(){
  // Can be used for future dashboard display
}

function showAlert(msg){
  const container=document.getElementById('alertsContainer');
  const div=document.createElement('div'); div.className='alert'; div.textContent=msg;
  container.appendChild(div); document.getElementById('alertsPopup').style.display='flex';
}

function closeAlerts(){ document.getElementById('alertsPopup').style.display='none'; document.getElementById('alertsContainer').innerHTML=''; }

function saveMealPlanner(){
  const menu=document.getElementById('mealPlanner').value;
  localStorage.setItem('mealPlanner', menu);
  showAlert('Meal Planner saved.');
}

function loadMealPlanner(){
  document.getElementById('mealPlanner').value = localStorage.getItem('mealPlanner') || '';
}

// Initialize
loadMealPlanner();
</script>

</body>
</html>
